import{k as e}from"./key-fa0d8a82.js";import{removeFocusHiddenAttribute as t,addFocusHiddenAttribute as s}from"./focus-utils-6f61e33c.js";import{T as n,z as i,A as o}from"./popup-c77dbf49.js";import{C as r}from"./custom-events-helper-e7f279d3.js";import{K as a,L as u}from"./dx-keyboard-navigator-51db54bd.js";import{b as d,e as l}from"./logicaltreehelper-99f1adf9.js";import{M as h}from"./constants-3937401e.js";class c{constructor(){this._objCaptured=new n,this._objReleased=new n,this._obj=null}get subject(){return this._obj}capture(e){if(null==e)throw new Error(`Value cannot be ${e}`);null!==this._obj&&this._objReleased.tryReject(`The object ${this._obj} was not released.`),this._objReleased=new n,this._obj=e,this._objCaptured.tryResolve(e)}release(){const e=this._obj;this._obj=null,e&&this._objReleased.tryResolve(e),this._objCaptured=new n}waitCapture(){return this._objCaptured.promise}waitRelease(){return this._objReleased.promise}}class m{constructor(){this._selectedItemIndices=[],this._initialSelectedItem=null,this._initNewState=!1,this._selectedItemIndex=0}get currentLevel(){return this._selectedItemIndices.length}get selectedItemIndex(){return this._selectedItemIndex}updateState(e,t){var s;this._initNewState?(this._selectedItemIndices.push(e),this._selectedItemIndex=this._initialSelectedItem===g.Last?t-1:0):this._selectedItemIndex=null!==(s=this._selectedItemIndices.pop())&&void 0!==s?s:e}moveToNextLevel(e){this._initNewState=!0,this._initialSelectedItem=e}moveToPrevLevel(){this._initNewState=!1}clearState(){this._selectedItemIndices=[],this._selectedItemIndex=0,this._initNewState=!1,this._initialSelectedItem=g.First}}function b(e){return e&&"hasPopup"in e.dataset}function p(e){return!!e&&"expanded"in e.dataset}function y(e,t){return e.classList.contains(t)}function I(e){return e.isConnected&&e.matches(":scope:focus-within")}var S,g;!function(e){e[e.Expand=0]="Expand",e[e.Collapse=1]="Collapse",e[e.Execute=2]="Execute"}(S||(S={}));class C extends CustomEvent{constructor(e){super(C.eventName,{detail:{action:e},bubbles:!0,composed:!1,cancelable:!0})}}C.eventName="dxbl-dropdown.action-request",r.register(C.eventName,(e=>e.detail)),function(e){e[e.First=0]="First",e[e.Last=1]="Last"}(g||(g={}));class _ extends i{canSwitchToNestedContentMode(){return!0}isImmediatelyClickEnabled(){return!1}updateSelectedItemByIndex(e){e<0&&(e=Math.min(this.selectedItemIndex,this.itemCount-1)),super.updateSelectedItemByIndex(e)}handleKeyDown(t){return!(e.KeyUtils.getEventKeyCode(t)===e.KeyCode.Tab&&!this.nestedContentSelected)&&(!!super.handleKeyDown(t)||!this.nestedContentSelected&&this.handleKeyDownCore(t))}focusFirstItem(){this.focusItem(0)}focusLastItem(){this.focusItem(this.itemCount-1)}focusItem(e){t(this.targetElement),this.updateSelectedItemByIndex(e),this.focusSelectedItem()}doClick(e,t){this.raiseClickEvent(e,t.ctrlKey,t.metaKey,t.shiftKey)}onPopupShown(){s(this.targetElement),super.onPopupShown()}}class w extends _{constructor(e,t){super(e,t),this._subMenuHolder=new c,this.boundOnPopupKeyboardStrategyCreating=this.onPopupKeyboardStrategyCreating.bind(this),this.subscribeToEvents()}get subMenuStrategy(){return this._subMenuHolder.subject}canSwitchToNestedContentMode(){return!this.subMenuStrategy}handleKeyDownCore(t){switch(e.KeyUtils.getEventKeyCode(t)){case e.KeyCode.Down:return!(t.ctrlKey||t.shiftKey||t.altKey)&&(this.moveToNextItem(!0),!0);case e.KeyCode.Up:return!(t.ctrlKey||t.shiftKey||t.altKey)&&(this.moveToPrevItem(!0),!0);case e.KeyCode.Home:return this.selectItem(0),!0;case e.KeyCode.End:return this.selectItem(this.itemCount-1),!0;case e.KeyCode.Enter:case e.KeyCode.Space:return this.selectedItemElement===this.targetElement&&this.switchToNestedContent()||this.doAction(t),!0;case e.KeyCode.Right:return this.handleRightKey(t);case e.KeyCode.Left:return this.handleLeftKey(t);default:return!1}}handleRightKey(e){return!(!b(this.selectedItemElement)||p(this.selectedItemElement))&&(this.openSubMenu(g.First),!0)}handleLeftKey(e){return this.closeSelf()}onSubMenuClosed(e){this._subMenuHolder.subject===e&&this._subMenuHolder.release(),this.focusSelectedItem()}onSubMenuShown(e){this._subMenuHolder.capture(e)}waitSubMenuShown(){return this._subMenuHolder.waitCapture()}waitSubMenuClosed(){return this._subMenuHolder.waitRelease()}requestSubMenuOpen(){var e;null===(e=this.selectedItemElement)||void 0===e||e.dispatchEvent(new C(S.Expand))}requestSubMenuClose(){var e;null===(e=this.selectedItemElement)||void 0===e||e.dispatchEvent(new C(S.Collapse))}subscribeToEvents(){this.targetElement.addEventListener(o.eventName,this.boundOnPopupKeyboardStrategyCreating)}onPopupKeyboardStrategyCreating(e){e.detail.factory={createPopup:(e,t)=>this.createSubMenuStrategy(e,t)}}}const f=`.${h.menuItem} > .dxbl-btn, .${h.menuItem} > .dxbl-menu-item-tmpl`,v="data-keyboard-navigator-is-ready";class K extends a{initialize(){super.initialize(),this.targetElement.setAttribute(v,"")}updateSelectedItemByIndex(e){e<0&&(e=Math.min(this.selectedItemIndex,this.itemCount-1)),super.updateSelectedItemByIndex(e)}isImmediatelyClickEnabled(){return!1}canSwitchToNestedContentMode(){return!0}handleKeyDown(e){return!!super.handleKeyDown(e)||!this.nestedContentSelected&&this.handleKeyDownCore(e)}}class M extends K{constructor(e,t){super(e,t),this.boundOnPopupKeyboardStrategyCreating=this.onPopupKeyboardStrategyCreating.bind(this),this._subMenuHolder=new c,this._shouldRestoreFocus=!1,this.subscribeToEvents()}get shouldRestoreFocus(){return this._shouldRestoreFocus}set shouldRestoreFocus(e){this._shouldRestoreFocus=e}subscribeToEvents(){this.targetElement.addEventListener(o.eventName,this.boundOnPopupKeyboardStrategyCreating)}onPopupKeyboardStrategyCreating(e){e.detail.factory={createPopup:(e,t)=>this.createPopupStrategy(e,t),createModal:(e,t)=>this.createModalStrategy(e,t)}}get subMenuStrategy(){return this._subMenuHolder.subject}canSwitchToNestedContentMode(){return!this.subMenuStrategy}onSubMenuShown(e){this.tryAddLogicalChild(e.targetElement),this._subMenuHolder.capture(e),this.shouldRestoreFocus=this.shouldRestoreFocus||I(this.targetElement)}onSubMenuClosed(e){this._subMenuHolder.subject===e&&this._subMenuHolder.release(),this.navigator.leaveDirection===u.None&&this.shouldRestoreFocus&&this.focusSelectedItem(),this.shouldRestoreFocus=!1,this.tryRemoveLogicalChild(e.targetElement)}tryAddLogicalChild(e){d(this.targetElement)&&l(e)&&(e.logicalParent||this.targetElement.addLogicalChild(e))}tryRemoveLogicalChild(e){d(this.targetElement)&&l(e)&&e.logicalParent===this.targetElement&&this.targetElement.removeLogicalChild(e)}waitSubMenuShown(){return this._subMenuHolder.waitCapture()}waitSubMenuClosed(){return this._subMenuHolder.waitRelease()}async focusSubMenuItemAsync(e){const t=await this.waitSubMenuShown();e===g.First?t.focusFirstItem():t.focusLastItem()}}export{M as D,v as K,m as M,w as P,b as a,g as b,I as c,C as d,S as e,f,K as g,y as h,p as i,_ as j};
