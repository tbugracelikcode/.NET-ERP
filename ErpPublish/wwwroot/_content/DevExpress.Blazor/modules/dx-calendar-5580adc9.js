import{d as e}from"./dom-e3fa5208.js";import{D as t}from"./dx-html-element-base-3bcbe019.js";import{C as s}from"./css-classes-f3f8ed66.js";import{_ as r}from"./_tslib-6e8ca86b.js";import{H as n,D as a,L as i,a as o,b as l,c as d}from"./dx-html-element-pointer-events-helper-1bf230d1.js";import{S as c}from"./single-slot-element-base-4efb3864.js";import{b as h}from"./constants-d4ec8d6f.js";import{e as u}from"./property-d3853089.js";import{R as m}from"./layouthelper-1d804c8c.js";import{C as y}from"./custom-events-helper-e7f279d3.js";import{K as g,a as f}from"./dx-keyboard-navigator-51db54bd.js";import{k as D}from"./key-fa0d8a82.js";import"./browser-f8f6e902.js";import"./common-eb095e4d.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-8570b930.js";import"./constants-58283e53.js";import"./devices-9f03a976.js";import"./dx-ui-element-db9e89a3.js";import"./lit-element-base-7a85dca5.js";import"./lit-element-70cf14f4.js";import"./logicaltreehelper-99f1adf9.js";import"./point-e4ec110e.js";import"./dispatcheraction-19309c7b.js";import"./focus-utils-6f61e33c.js";import"./touch-167bb2e4.js";import"./disposable-d2c2d283.js";import"./dom-utils-eacbb99f.js";class v{}var p,C;v.MainElement=s.Prefix+"-calendar",v.SelectedItem=v.MainElement+"-selected-item",v.SelectedRange=v.MainElement+"-selected-range",v.Header=v.MainElement+"-header",v.Content=v.MainElement+"-content",v.Footer=v.MainElement+"-footer",v.WeekRow=v.MainElement+"-week-row",v.YearRow=v.MainElement+"-year-row",v.DecadeRow=v.MainElement+"-decade-row",v.CenturyRow=v.MainElement+"-century-row",v.Day=v.MainElement+"-day",v.NotCurrentView=v.MainElement+"-not-current-view",v.HeaderHelper=v.MainElement+"-header",v.HeaderTitleButton=v.HeaderHelper+"-title-btn",v.HeaderPreviousYearButton=v.HeaderHelper+"-previous-year-btn",v.HeaderPreviousMonthButton=v.HeaderHelper+"-previous-month-btn",v.HeaderPreviousPeriodButton=v.HeaderHelper+"-previous-period-btn",v.HeaderNextYearButton=v.HeaderHelper+"-next-year-btn",v.HeaderNextMonthButton=v.HeaderHelper+"-next-month-btn",v.HeaderNextPeriodButton=v.HeaderHelper+"-next-period-btn",function(e){e.class="class",e.view="view",e.viewDate="view-date",e.enableMultiSelect="enable-multi-select"}(p||(p={})),function(e){e.dataDate="data-date",e.dataMonth="data-month",e.dataYear="data-year",e.dataDecade="data-decade"}(C||(C={}));const I=12,b="dxbl-calendar-table-container",w=new Date(new Date(Date.UTC(1,0,1)).setUTCFullYear(1)),S=new Date(Date.UTC(9999,11,31)),E=864e5;class T{constructor(e){this._pointerDownDate=e.pointerDownDate,this._pointerUpDate=null,this._clearSelection=e.clearSelection,this.dayCellElements=e.dayCellElements,this.refreshUI(!1)}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate!==e&&e&&(this._pointerUpDate=e,this.refreshUI(!0))}get isValid(){return!!this._pointerUpDate}stop(){this.refreshUI(!1)}cancel(){for(let e=0;e<this.dayCellElements.length;e++){const t=this.dayCellElements[e];T.removeDayCellSelectedClasses(t),t.hasAttribute("data-selected")&&T.addSelectedClassesToCell(t)}}refreshUI(t){const s=this.getStartPointedDateRange(),r=this.getEndPointedDateRange();for(let n=0;n<this.dayCellElements.length;n++){const a=this.dayCellElements[n];if(this.isDateCellDisabled(a))continue;const i=Number(a.dataset.date);T.removeDayCellSelectedClasses(a),t&&this.isDateRangeBoundary(i,s,r)&&e.DomUtils.addClassName(a,v.SelectedRange),this.needApplySelectedStyle(i,s,r,t)&&T.addSelectedClassesToCell(a),a.hasAttribute("data-selected")&&!this.clearSelection&&T.addSelectedClassesToCell(a)}}getStartPointedDateRange(){return this.pointerUpDate?Math.min(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}getEndPointedDateRange(){return this.pointerUpDate?Math.max(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}needApplySelectedStyle(e,t,s,r){return!(e<t||e>s)&&(!r||!this.isDateRangeBoundary(e,t,s))}isDateRangeBoundary(e,t,s){if(!this.isDateDisabled(e)&&(e===t||e===s))return!0;return!(!(e>t&&e<s)||e!==this.getBoundaryDate(t,e)&&e!==this.getBoundaryDate(s,e))}getBoundaryDate(e,t){const s=e<t,r=s?1:-1;let n=e;for(;(s?n<t:n>t)&&this.isDateDisabled(n);)n+=r*E;return n}isDateCellDisabled(e){return e.hasAttribute("data-disabled")}isDateDisabled(e){const t=this.getDayCellByDay(e);return null!=t&&this.isDateCellDisabled(t)}getDayCellByDay(e){for(let t=0;t<this.dayCellElements.length;t++)if(this.dayCellElements[t].getAttribute(C.dataDate)===e.toString())return this.dayCellElements[t];return null}static addSelectedClassesToCell(t){e.DomUtils.addClassName(t,v.SelectedItem)}static removeDayCellSelectedClasses(t){e.DomUtils.removeClassName(t,v.SelectedItem),e.DomUtils.removeClassName(t,v.SelectedRange),e.DomUtils.removeClassName(t,"text-white")}}class M{constructor(e,t){this._pointerDownDate=e,this._pointerUpDate=null,this._clearSelection=t}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate=e}get isValid(){var e;return this.pointerDownDate.getTime()===(null===(e=this.pointerUpDate)||void 0===e?void 0:e.getTime())}stop(){}cancel(){}}var F,x,P,B;!function(e){e[e.PreviousYear=0]="PreviousYear",e[e.PreviousMonth=1]="PreviousMonth",e[e.Title=2]="Title",e[e.NextMonth=3]="NextMonth",e[e.NextYear=4]="NextYear",e[e.PreviousPeriod=5]="PreviousPeriod",e[e.NextPeriod=6]="NextPeriod"}(F||(F={})),function(e){e[e.Header=0]="Header",e[e.DataTable=1]="DataTable",e[e.Footer=2]="Footer"}(x||(x={})),function(e){e[e.Month=0]="Month",e[e.Year=1]="Year",e[e.Decade=2]="Decade",e[e.Century=3]="Century"}(P||(P={})),function(e){e[e.January=0]="January",e[e.February=1]="February",e[e.March=2]="March",e[e.April=3]="April",e[e.May=4]="May",e[e.June=5]="June",e[e.July=6]="July",e[e.August=7]="August",e[e.September=8]="September",e[e.October=9]="October",e[e.November=10]="November",e[e.December=11]="December"}(B||(B={}));class H extends c{constructor(){super(),this._handlePointerEventsMode=n.None,this.viewDate=new Date,this.viewType=P.Month,this._pointerEventsHelper=new a(this)}get calendar(){return this._calendar||(this._calendar=e.DomUtils.getParentByTagName(this,h)),this._calendar}connectedCallback(){super.connectedCallback(),this._pointerEventsHelper.initialize()}disconnectedCallback(){super.disconnectedCallback(),this._pointerEventsHelper.dispose()}updated(e){e.has("viewDate")&&this.calendar.restoreFocus(),e.has("viewType")&&(this._handlePointerEventsMode=n.None,this.viewType===P.Month&&(this.calendar.fixCalendarTableSize(),this._handlePointerEventsMode=n.Click|n.Dragging),this.calendar.restoreFocus()),super.updated(e)}get handlePointerEventsMode(){return this._handlePointerEventsMode}get handlePointerEventsTarget(){return this}get handlePointerEventsDelay(){return i}get hoverTitleElementsSelector(){return null}}r([u({attribute:p.viewDate,converter:e=>new Date(Number(e))})],H.prototype,"viewDate",void 0),r([u({type:Number,attribute:p.view})],H.prototype,"viewType",void 0);class R extends CustomEvent{constructor(e,t,s){super(R.eventName,{detail:new N(e,t,s),bubbles:!0,composed:!0,cancelable:!0})}}R.eventName=h+".daycellpointerup";class N{constructor(e,t,s){this.PointerDownDate=e,this.PointerUpDate=t,this.ClearSelection=s}}y.register(R.eventName,(e=>e.detail));class K extends g{constructor(e,t){super(e.getKeyboardNavigator(),t),this.calendar=e}isFocusedFromOutside(){return this.calendar.isSameNode(document.activeElement)}isDateEarlierThanFirstAccessible(e){return e instanceof Date?e<w:!(e.hasAttribute(C.dataDate)&&!isNaN(parseInt(e.getAttribute(C.dataDate))))||Q.getDateFromCell(e)<w}isDateLaterThanLastAccessible(e){return e instanceof Date?e>S:!(e.hasAttribute(C.dataDate)&&!isNaN(parseInt(e.getAttribute(C.dataDate))))||Q.getDateFromCell(e)>S}isDateOutOfBoundaries(e,t){const s=Q.getDateRelativeTo(e,t);return this.isDateEarlierThanFirstAccessible(s)||this.isDateLaterThanLastAccessible(s)}isFocusedFromDataTable(){var e,t;return null!==(t=null===(e=this.getDataTableContainer())||void 0===e?void 0:e.contains(document.activeElement))&&void 0!==t&&t}getHeader(){return this.calendar.getHeaderElement()}getDataTableContainer(){return this.calendar.tableContainer}getFooter(){return this.calendar.getFooterElement()}}class O extends K{constructor(e,t){super(e,t),this.itemSelector=`:scope > .${s.Button}:not(.${s.Disabled})`,this.buttonClassToButtonType=new Map([[v.HeaderPreviousYearButton,F.PreviousYear],[v.HeaderPreviousMonthButton,F.PreviousMonth],[v.HeaderPreviousPeriodButton,F.PreviousPeriod],[v.HeaderTitleButton,F.Title],[v.HeaderNextYearButton,F.NextYear],[v.HeaderNextMonthButton,F.NextMonth],[v.HeaderNextPeriodButton,F.NextPeriod]]),this.buttonTypeToButtonClass=new Map([[F.PreviousYear,v.HeaderPreviousYearButton],[F.PreviousMonth,v.HeaderPreviousMonthButton],[F.PreviousPeriod,v.HeaderPreviousPeriodButton],[F.Title,v.HeaderTitleButton],[F.NextYear,v.HeaderNextYearButton],[F.NextMonth,v.HeaderNextMonthButton],[F.NextPeriod,v.HeaderNextPeriodButton]])}getShortcutContext(){return{AreaType:x.Header,ButtonType:this.getSelectedButtonType()}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}activate(){const e=this.getButtonIndexByType(this.lastFocusedButtonType);this.selectedItemIndex=this.isFocusedFromOutside()?0:this.isFocusedFromDataTable()?this.itemCount-1:null!=e?e:0,super.activate()}leaveBackward(){this.lastFocusedButtonType=void 0,super.leaveBackward()}leaveForward(){this.lastFocusedButtonType=void 0,super.leaveForward()}handleKeyDown(e){switch(D.KeyUtils.getEventKeyCode(e)){case D.KeyCode.Tab:return e.shiftKey?this.moveToPrevItem():this.moveToNextItem();case D.KeyCode.Space:case D.KeyCode.Enter:return this.performShortcutEvent(e),!0}return super.handleKeyDown(e)}moveToPrevItem(){return this.selectedItemIndex>0&&(this.selectItem(this.selectedItemIndex-1),!0)}moveToNextItem(){return this.selectedItemIndex<this.itemCount-1&&(this.selectItem(this.selectedItemIndex+1),!0)}updateSelectedItemByIndex(e){super.updateSelectedItemByIndex(e),this.lastFocusedButtonType=this.getSelectedButtonType()}getSelectedButtonType(){for(const e of this.selectedItemElement.classList)if(this.buttonClassToButtonType.has(e))return this.buttonClassToButtonType.get(e)}getButtonIndexByType(e){return e?this.items.findIndex((t=>t.classList.contains(this.buttonTypeToButtonClass.get(e)))):void 0}}class Y extends K{get isObsolete(){return this.calendar.currentView!==this.currentCalendarView}constructor(e,t){super(e,t),this.boundCalendarFocusedDayChangedHandler=this.onCalendarFocusedDayChanged.bind(this),this.calendar.onFocusedDayChanged(this.boundCalendarFocusedDayChangedHandler)}getShortcutContext(){const e=this.lastShortcutArgs;return delete this.lastShortcutArgs,{AreaType:x.DataTable,Offset:null==e?void 0:e.offset,Row:null==e?void 0:e.row,Column:null==e?void 0:e.column,Date:null==e?void 0:e.date}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}handleKeyDown(e){switch(D.KeyUtils.getEventKeyCode(e)){case D.KeyCode.Left:return!e.ctrlKey&&!e.metaKey&&(this.moveToPrevDay(e),!0);case D.KeyCode.Right:return!e.ctrlKey&&!e.metaKey&&(this.moveToNextDay(e),!0);case D.KeyCode.Up:return!e.ctrlKey&&!e.metaKey&&(this.moveToPrevRow(e),!0);case D.KeyCode.Down:return!e.ctrlKey&&!e.metaKey&&(this.moveToNextRow(e),!0);case D.KeyCode.Home:return this.handleHomeKey(e),!0;case D.KeyCode.End:return this.handleEndKey(e),!0;case D.KeyCode.PageUp:return this.calendar.scheduleFocusRestoration(),this.handlePageUpKey(e),!0;case D.KeyCode.PageDown:return this.calendar.scheduleFocusRestoration(),this.handlePageDownKey(e),!0;case D.KeyCode.Enter:case D.KeyCode.Space:return this.handleItemClick(e),!0}return super.handleKeyDown(e)}getSelectedItemRowIndex(){return Math.floor(this.selectedItemIndex/this.rowLength)}getSelectedItemColumnIndex(){return Math.floor(this.selectedItemIndex%this.rowLength)}handlePageUpKey(e,t){this.prepareAndPerformShortcutEvent(e,{offset:null!=t?t:e.shiftKey?-12:-1,date:e.shiftKey?Q.getDateFromCell(this.selectedItemElement):void 0})}handlePageDownKey(e,t){this.prepareAndPerformShortcutEvent(e,{offset:null!=t?t:e.shiftKey?I:1,date:e.shiftKey?Q.getDateFromCell(this.selectedItemElement):void 0})}prepareAndPerformShortcutEvent(e,t){this.lastShortcutArgs=t,this.performShortcutEvent(e)}onCalendarFocusedDayChanged(e){e&&(this.tryRestoreSelectedItem(e),this.selectItem(this.selectedItemIndex))}}class U extends Y{get rowLength(){return 7}get currentCalendarView(){return P.Month}get itemSelector(){return`:scope .${v.WeekRow} > .${v.Day}`}activate(){this.applyCalendarFocus(),super.activate()}moveToPrevDay(e){var t;const s={value:-1,isHorizontal:!0};if(this.isDateOutOfBoundaries(s,this.selectedItemElement))return;const r=this.calendar.tryMoveFocus(s,this.selectedItemElement);r.needChangePeriod?this.switchCurrentMonth(e,null!==(t=r.offset)&&void 0!==t?t:-1):(super.moveToPrevItem(),e.shiftKey&&this.handleItemClick(e))}moveToNextDay(e){var t;const s={value:1,isHorizontal:!0};if(this.isDateOutOfBoundaries(s,this.selectedItemElement))return;const r=this.calendar.tryMoveFocus(s,this.selectedItemElement);r.needChangePeriod?this.switchCurrentMonth(e,null!==(t=r.offset)&&void 0!==t?t:1):(super.moveToNextItem(),e.shiftKey&&this.handleItemClick(e))}moveToPrevRow(e){var t;const s={value:-1,isHorizontal:!1};if(this.isDateOutOfBoundaries(s,this.selectedItemElement))return;const r=this.calendar.tryMoveFocus(s,this.selectedItemElement);r.needChangePeriod?this.switchCurrentMonth(e,null!==(t=r.offset)&&void 0!==t?t:-1):(this.selectedItemIndex>=this.rowLength&&this.selectItem(this.selectedItemIndex-this.rowLength),e.shiftKey&&this.handleItemClick(e))}moveToNextRow(e){var t;const s={value:1,isHorizontal:!1};if(this.isDateOutOfBoundaries(s,this.selectedItemElement))return;const r=this.calendar.tryMoveFocus(s,this.selectedItemElement);r.needChangePeriod?this.switchCurrentMonth(e,null!==(t=r.offset)&&void 0!==t?t:1):(this.selectedItemIndex<=this.itemCount-this.rowLength&&this.selectItem(this.selectedItemIndex+this.rowLength),e.shiftKey&&this.handleItemClick(e))}handleHomeKey(e){var t;const s=this.getIndexOfFirstAccessibleItemInCurrentRow(),r=this.calendar.tryMoveFocus({value:s-this.selectedItemIndex,isHorizontal:!0},this.selectedItemElement);r.needChangePeriod?this.switchCurrentMonth(e,null!==(t=r.offset)&&void 0!==t?t:-1):(this.selectItem(s),e.shiftKey&&this.handleItemClick(e))}handleEndKey(e){var t;const s=this.getIndexOfLastAccessibleItemInCurrentRow(),r=this.calendar.tryMoveFocus({value:s-this.selectedItemIndex,isHorizontal:!0},this.selectedItemElement);r.needChangePeriod?this.switchCurrentMonth(e,null!==(t=r.offset)&&void 0!==t?t:1):(this.selectItem(s),e.shiftKey&&this.handleItemClick(e))}handlePageUpKey(e){const t={value:-(e.shiftKey?Q.getYearOffsetInDaysFrom(-1,this.selectedItemElement):Q.getMonthOffsetInDaysFrom(-1,this.selectedItemElement)),isHorizontal:!0};if(this.isDateOutOfBoundaries(t,this.selectedItemElement))return;const s=this.calendar.tryMoveFocus(t,this.selectedItemElement);s.needChangePeriod?super.handlePageUpKey(e,s.offset):(this.applyCalendarFocus(),this.selectItem(this.selectedItemIndex))}handlePageDownKey(e){const t={value:e.shiftKey?Q.getYearOffsetInDaysFrom(1,this.selectedItemElement):Q.getMonthOffsetInDaysFrom(1,this.selectedItemElement),isHorizontal:!0};if(this.isDateOutOfBoundaries(t,this.selectedItemElement))return;const s=this.calendar.tryMoveFocus(t,this.selectedItemElement);s.needChangePeriod?super.handlePageDownKey(e,s.offset):(this.applyCalendarFocus(),this.selectItem(this.selectedItemIndex))}handleItemClick(e){this.prepareAndPerformShortcutEvent(e,{date:Q.getDateFromCell(this.selectedItemElement)})}switchCurrentMonth(e,t){this.prepareAndPerformShortcutEvent(e,{offset:t,date:this.calendar.focusedDate})}getIndexOfFirstAccessibleItemInCurrentRow(){let e=this.getSelectedItemRowIndex()*this.rowLength;for(;e<=this.selectedItemIndex&&this.isDateEarlierThanFirstAccessible(this.getItem(e));)e++;return e}getIndexOfLastAccessibleItemInCurrentRow(){let e=(this.getSelectedItemRowIndex()+1)*this.rowLength-1;for(;e>=this.selectedItemIndex&&this.isDateEarlierThanFirstAccessible(this.getItem(e));)e--;return e}applyCalendarFocus(){var e;const t=null!==(e=this.calendar.focusedCellElement)&&void 0!==e?e:this.targetElement.querySelector(`.${v.SelectedItem}`);t&&this.tryRestoreSelectedItem(t)}}class _ extends Y{get rowLength(){return 4}initialize(){super.initialize();const e=this.targetElement.querySelector(`.${v.SelectedItem}`);e&&this.tryRestoreSelectedItem(e)}moveToPrevDay(e){this.calendar.tryMoveFocus({value:-1,isHorizontal:!0},this.selectedItemElement).needChangePeriod?this.switchCurrentMonth(e,-1):super.moveToPrevItem()}moveToNextDay(e){this.calendar.tryMoveFocus({value:1,isHorizontal:!0},this.selectedItemElement).needChangePeriod?this.switchCurrentMonth(e,1):super.moveToNextItem()}moveToPrevRow(e){this.calendar.tryMoveFocus({value:-1,isHorizontal:!1},this.selectedItemElement).needChangePeriod?this.switchCurrentMonth(e,-1):this.selectedItemIndex>=this.rowLength&&this.selectItem(this.selectedItemIndex-this.rowLength)}moveToNextRow(e){this.calendar.tryMoveFocus({value:1,isHorizontal:!1},this.selectedItemElement).needChangePeriod?this.switchCurrentMonth(e,1):this.selectedItemIndex<this.itemCount-this.rowLength&&this.selectItem(this.selectedItemIndex+this.rowLength)}handleHomeKey(e){const t=this.getIndexOfFirstAccessibleItemInCurrentView();this.calendar.tryMoveFocus({value:t-this.selectedItemIndex,isHorizontal:!0},this.selectedItemElement).needChangePeriod||this.selectItem(t)}handleEndKey(e){const t=this.getIndexOfLastAccessibleItemInCurrentView();this.calendar.tryMoveFocus({value:t-this.selectedItemIndex,isHorizontal:!0},this.selectedItemElement).needChangePeriod||this.selectItem(t)}handleItemClick(e){this.calendar.scheduleFocusRestoration(),this.prepareAndPerformShortcutEvent(e,{row:this.getSelectedItemRowIndex(),column:this.getSelectedItemColumnIndex()})}switchCurrentMonth(e,t){this.prepareAndPerformShortcutEvent(e,{offset:t})}getIndexOfFirstAccessibleItemInCurrentView(){let e=0;for(;e<=this.selectedItemIndex&&!this.itemBelongsToCurrentView(e);)e++;return e}getIndexOfLastAccessibleItemInCurrentView(){let e=this.itemCount-1;for(;e>=this.selectedItemIndex&&!this.itemBelongsToCurrentView(e);)e--;return e}itemBelongsToCurrentView(e){var t;return!(null===(t=this.getItem(e))||void 0===t?void 0:t.classList.contains(v.NotCurrentView))}}class A extends _{get currentCalendarView(){return P.Year}get itemSelector(){return`:scope .${v.YearRow} > td`}}class z extends _{get currentCalendarView(){return P.Decade}get itemSelector(){return`:scope .${v.DecadeRow} > td:not(.${s.Invisible})`}}class L extends _{get currentCalendarView(){return P.Century}get itemSelector(){return`:scope .${v.CenturyRow} > td:not(.${s.Invisible})`}}class k extends K{constructor(e,t){super(e,t),this.itemSelector=`:scope > .${s.Button}`}getShortcutContext(){return{AreaType:x.Footer,ButtonType:this.selectedItemIndex}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}activate(){this.selectedItemIndex=this.isFocusedFromOutside()?this.itemCount-1:0,super.activate()}handleKeyDown(e){switch(D.KeyUtils.getEventKeyCode(e)){case D.KeyCode.Tab:return e.shiftKey?this.moveToPrevItem():this.moveToNextItem();case D.KeyCode.Space:case D.KeyCode.Enter:return this.performShortcutEvent(e),!0}return super.handleKeyDown(e)}moveToPrevItem(){return this.selectedItemIndex>0&&(this.selectItem(this.selectedItemIndex-1),!0)}moveToNextItem(){return this.selectedItemIndex<this.itemCount-1&&(this.selectItem(this.selectedItemIndex+1),!0)}}class V extends K{constructor(e){super(e,e)}queryItems(){return new Array(this.getHeader(),this.getDataTableContainer(),this.getFooter())}createItemStrategy(e){if(e===this.getHeader())return new O(this.calendar,e);if(e===this.getDataTableContainer())return this.createDataTableStrategy(e);if(e===this.getFooter())return new k(this.calendar,e);throw new Error("Not implemented")}createDataTableStrategy(e){switch(e.viewType){case P.Month:return new U(this.calendar,e);case P.Year:return new A(this.calendar,e);case P.Decade:return new z(this.calendar,e);case P.Century:return new L(this.calendar,e)}}handleKeyDown(e){const t=D.KeyUtils.getEventKeyCode(e);return t===D.KeyCode.Tab?(e.shiftKey?this.moveToPrevItem():this.moveToNextItem(),!0):!e.ctrlKey||t!==D.KeyCode.Up&&t!==D.KeyCode.Down?super.handleKeyDown(e):(this.calendar.scheduleFocusRestoration(),this.performShortcutEvent(e),!0)}moveToPrevItem(){this.selectedItemIndex>0?super.moveToPrevItem():this.leaveBackward()}moveToNextItem(){this.selectedItemIndex<this.itemCount-1?super.moveToNextItem():this.leaveForward()}}class ${get focusedItem(){return this._focusedItem}set focusedItem(e){this._focusedItem=e}get focusedElement(){return this._focusedElement}set focusedElement(e){this._focusedElement=e}get calendar(){return this._calendar}constructor(e){this._calendar=e,this._focusedElement=null}get calendarCurrentViewDate(){return this.calendar.currentViewDate}getUpdatedElementToFocus(){return this.focusedElement=this.findCellElementByItem(this.getUpdatedItemToFocus()),this.focusedElement}findSelectedCellElement(){return this.calendar.querySelector(`td.${v.SelectedItem}`)}}class j extends ${tryMoveFocus(e,t){const s=this.getNewRawIndex(e,t);return this.focusedItem=this.getNewMonthByRawIndex(s),this.focusedElement=this.findCellElementByItem(this.focusedItem),{needChangePeriod:this.areMonthsDifferByYear(s)}}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?Q.getMonthFromCell(e):this.calendarCurrentViewDate.getMonth()}return this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataMonth}="${B[e]}"]`)}getNewMonthByRawIndex(e){if(void 0===e)return;return B[B[(e%I+I)%I%I]]}getNewRawIndex(e,t){const s=Q.getMonthFromCell(t);if(void 0!==s)return s+this.getEffectiveOffset(e)}getEffectiveOffset(e){return e.value*(e.isHorizontal?1:4)}areMonthsDifferByYear(e){return void 0!==e&&(e<0||e>=I)}}class q extends ${tryMoveFocus(e,t){const s=Q.getYearFromCell(t);return this.focusedItem=this.getYearRelativeTo(e,s),this.focusedElement=this.findCellElementByItem(this.focusedItem),{needChangePeriod:this.areYearsDifferByDecade(this.calendarCurrentViewDate.getFullYear(),this.focusedItem)}}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?Q.getYearFromCell(e):this.calendarCurrentViewDate.getFullYear()}return this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataYear}="${e}"]`)}getYearRelativeTo(e,t){if(void 0!==t)return t+this.getEffectiveOffset(e)}getEffectiveOffset(e){return e.value*(e.isHorizontal?1:4)}areYearsDifferByDecade(e,t){return void 0!==e&&void 0!==t&&Math.floor(e/10)!==Math.floor(t/10)}}class J extends ${tryMoveFocus(e,t){this.focusedItem=Q.getDateRelativeTo(e,t),this.focusedElement=this.findCellElementByItem(this.focusedItem);const s=this.areDatesDifferByMonthOrYear(this.calendarCurrentViewDate,this.focusedItem);return{needChangePeriod:s,offset:s?this.getShortcutOffsetInMonths(this.focusedItem,this.calendarCurrentViewDate):void 0}}getUpdatedItemToFocus(){if(this.focusedItem=this.getFindCachedFocusedItem(),this.areDatesDifferByMonthOrYear(this.focusedItem,this.calendarCurrentViewDate)){const e=this.focusedItem.getDate();this.focusedItem=new Date(this.calendarCurrentViewDate);let t=this.trySetDate(this.focusedItem,e);null===t&&(t=this.trySetDate(this.focusedItem,this.calendarCurrentViewDate.getDate())),null===t&&(t=this.trySetDate(this.focusedItem,1)),this.focusedItem=t}return this.focusedItem}getFindCachedFocusedItem(){let e=this.focusedItem;if(void 0===e){const t=this.findSelectedCellElement();e=t?Q.getDateFromCell(t):this.calendarCurrentViewDate}return e}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`.${v.Day}[${C.dataDate}="${e.getTime()}"]`)}areDatesDifferByMonthOrYear(e,t){return e.getMonth()!==t.getMonth()||this.areDatesDifferByYear(e,t)}areDatesDifferByYear(e,t){return e.getUTCFullYear()!==t.getUTCFullYear()}trySetDate(e,t){const s=new Date(e);return s.setDate(t),this.areDatesDifferByMonthOrYear(s,e)?null:s}getShortcutOffsetInMonths(e,t){return e.getMonth()-t.getMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*I}}class W extends ${tryMoveFocus(e,t){const s=Q.getDecadeFromCell(t);return this.focusedItem=this.getDecadeRelativeTo(e,s),this.focusedElement=this.findCellElementByItem(this.focusedItem),{needChangePeriod:this.areDecadesDifferByCentury(this.getCurrentDecade(),this.focusedItem)}}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?Q.getDecadeFromCell(e):this.getCurrentDecade()}return this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataDecade}="${e.startYear}-${e.endYear}"]`)}getDecadeRelativeTo(e,t){if(void 0===t)return;const s=t.startYear+this.getEffectiveOffset(e);return{startYear:s,endYear:s+9}}getEffectiveOffset(e){return e.value*(e.isHorizontal?1:4)*10}areDecadesDifferByCentury(e,t){return void 0!==(null==e?void 0:e.startYear)&&void 0!==(null==t?void 0:t.startYear)&&Math.floor(e.startYear/100)!==Math.floor(t.startYear/100)}getCurrentDecade(){const e=this.calendarCurrentViewDate.getFullYear(),t=100*Math.floor(e/100);return{startYear:t,endYear:t+9}}}const G=document.createElement("template");G.innerHTML="\n<style></style>\n<slot />";class Q extends t{constructor(){super(),this.boundOnStartDaySelectionHandler=this.onStartDaySelection.bind(this),this.boundOnStopDaySelectionHandler=this.onStopDaySelection.bind(this),this.boundOnCancelDaySelectionHandler=this.onCancelDaySelection.bind(this),this.boundOnDayCellPointerEnterHandler=this.onDayCellPointerEnter.bind(this),this._enableMultiSelect=!1,this._focusedCellElement=null,this._focusStrategies={[P.Month]:new J(this),[P.Year]:new j(this),[P.Decade]:new q(this),[P.Century]:new W(this)},this._focusRestorationScheduled=!0,this.daySelectionRenderer=null,this.calendarTableResizeObserver=new ResizeObserver(this.onCalendarTableSizeChanged.bind(this)),this.focusedDayChangedHandlers=[]}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e}get currentViewDate(){return this.tableContainer.viewDate}get currentView(){var e,t;return null!==(t=null===(e=this.tableContainer)||void 0===e?void 0:e.viewType)&&void 0!==t?t:P.Month}get focusedCellElement(){return this._focusStrategies[P.Month].getUpdatedElementToFocus()}get focusedDate(){return this._focusStrategies[P.Month].getFindCachedFocusedItem()}get tableContainer(){return this._tableContainer||(this._tableContainer=this.querySelector(`${b}`)),this._tableContainer}connectedCallback(){super.connectedCallback(),this.addEventSubscriptions()}initializeComponent(){super.initializeComponent(),this.fixCalendarTableSize(),this.initializeKeyboardNavigator()}disposeComponent(){this.removeEventSubscriptions(),super.disposeComponent()}disconnectedCallback(){this.calendarTableResizeObserver.disconnect(),super.disconnectedCallback()}fixCalendarTableSize(){if(this.currentView!==P.Month)return;const e=this.getTableElement();if(!e)return;e.style.width="",e.style.height="";const t=e.getBoundingClientRect();m.fromDomRect(t).isEmpty?this.calendarTableResizeObserver.observe(e):this.applyTableSize(e,t.width,t.height)}applyTableSize(e,t,s){e.style.width=t+"px",e.style.height=s+"px"}onCalendarTableSizeChanged(e){if(e.length<1)return;const t=e[0].target,s=e[0].contentRect;m.fromDomRect(s).isEmpty||(this.applyTableSize(t,s.width,s.height),this.calendarTableResizeObserver.disconnect())}addEventSubscriptions(){this.addEventListener(o.eventName,this.boundOnStartDaySelectionHandler),this.addEventListener(l.eventName,this.boundOnStopDaySelectionHandler),this.addEventListener(d.eventName,this.boundOnCancelDaySelectionHandler)}removeEventSubscriptions(){this.removeEventListener(o.eventName,this.boundOnStartDaySelectionHandler),this.removeEventListener(l.eventName,this.boundOnStopDaySelectionHandler),this.removeEventListener(d.eventName,this.boundOnCancelDaySelectionHandler)}addDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].addEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}removeDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].removeEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}onStartDaySelection(t){if(e.DomUtils.hasClassName(this,s.Disabled)||e.DomUtils.hasClassName(this,s.ReadOnly))return;const r=Q.getDateFromTarget(t.detail.source.target);if(!r)return;this.daySelectionRenderer=this.createDaySelectionRenderer(r,!t.detail.isLongTap&&(!(t.detail.source.ctrlKey||t.detail.source.metaKey)||t.detail.isTouch)),this.addDayCellEventSubscriptions(),t.stopPropagation()}onStopDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=Q.getDateFromTarget(e.detail.source.target),this.daySelectionRenderer.stop(),this.raiseSelectionChanged(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}onCancelDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.cancel(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}raiseSelectionChanged(){this.daySelectionRenderer&&this.daySelectionRenderer.isValid&&this.invokeDayCellPointerUp(this.daySelectionRenderer.pointerDownDate,this.daySelectionRenderer.pointerUpDate,this.daySelectionRenderer.clearSelection)}invokeDayCellPointerUp(e,t,s){this.dispatchEvent(new R(e,t,s))}onDayCellPointerEnter(e){if(!this.daySelectionRenderer)return;const t=Q.getDateFromTarget(e.target);this.daySelectionRenderer.pointerUpDate=t}createDaySelectionRenderer(e,t){return this.enableMultiSelect?new T({pointerDownDate:e,clearSelection:t,dayCellElements:this.findDayCellElements()}):new M(e,t)}findDayCellElements(){return this.querySelectorAll(`.${v.Day}`)}getMainElement(){return this.querySelector(`.${v.MainElement}`)}getHeaderElement(){return this.querySelector(`.${v.Header}`)}getTableElement(){return this.querySelector(`.${v.Content} > table`)}getFooterElement(){return this.querySelector(`.${v.Footer}`)}initializeKeyboardNavigator(){this.keyboardNavigator=this.querySelector(f),this.keyboardNavigator&&!this.keyboardNavigator.initialized&&this.keyboardNavigator.initialize(this,new V(this))}getKeyboardNavigator(){return this.keyboardNavigator}tryMoveFocus(e,t){const s=this._focusStrategies[this.currentView].tryMoveFocus(e,t);return s.needChangePeriod&&this.scheduleFocusRestoration(),s}static getDateRelativeTo(e,t){const s=Q.getDateFromCell(t),r=new Date(s);return new Date(r.setDate(r.getDate()+e.value*(e.isHorizontal?1:7)))}scheduleFocusRestoration(){this._focusRestorationScheduled=!0}restoreFocus(){const e=this._focusStrategies[this.currentView].getUpdatedElementToFocus();this._focusRestorationScheduled&&(this._focusRestorationScheduled=!1,this.tryFireFocusedDayChanged(e))}onFocusedDayChanged(e){this.focusedDayChangedHandlers.push(e)}tryFireFocusedDayChanged(e){if(null!==e)for(const t of this.focusedDayChangedHandlers)t(e)}static getDateFromTarget(e){const t=Q.getDayCellByTarget(e);return t?Q.getDateFromCell(t):null}static getDayCellByTarget(t){const s=t;return s?e.DomUtils.hasClassName(s,v.Day)?s:s.closest(`.${v.Day}`):null}static getDateFromCell(e){return new Date(Number(e.getAttribute(C.dataDate)))}static getMonthFromCell(e){const t=e.getAttribute(C.dataMonth);if(t)return B[t]}static getYearFromCell(e){const t=e.getAttribute(C.dataYear);if(t)return Number(t)}static getDecadeFromCell(e){const t=e.getAttribute(C.dataDecade);if(!t)return;const[s,r]=t.split("-").map(Number);return{startYear:s,endYear:r}}static getMonthOffsetInDaysFrom(e,t){const s=Q.getDateFromCell(t),r=s.getDate(),n=new Date(s);n.setDate(1),n.setMonth(n.getMonth()+e);const a=this.getLastDayOfTheMonth(n);return n.setDate(r>a?a:r),Math.abs(n.getTime()-s.getTime())/E}static getYearOffsetInDaysFrom(e,t){const s=Q.getDateFromCell(t),r=s.getDate(),n=new Date(s);n.setDate(1),n.setFullYear(n.getFullYear()+e);const a=this.getLastDayOfTheMonth(n);return n.setDate(r>a?a:r),Math.abs(n.getTime()-s.getTime())/E}static getLastDayOfTheMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}getContentTemplate(){return G}static get observedAttributes(){return[p.class,p.enableMultiSelect]}attributeChangedCallback(e,t,s){switch(e){case p.class:this.fixCalendarTableSize();break;case p.enableMultiSelect:this.enableMultiSelect=null!==s}}}customElements.define(h,Q),customElements.define(b,H);const X={loadModule:function(){}};export{Q as DxCalendar,X as default};
