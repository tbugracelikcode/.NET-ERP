@page "/machine-analysis-general"

@inject IstasyonService IstasyonService
@inject NavigationManager NavigationManager
<style>
    .GridZebra table tbody tr:nth-child(odd) {
        background-color: #B5B5B5;
    }

    .GridZebra table tbody tr:nth-child(n) {
        text-align: center;
    }

    table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 80%;
    }

    /* td, th {
                            border: 0px solid #dddddd;
                            text-align: center;
                            padding: 8px;
                        }*/
    .DateTime {
        width: 400px;
    }

</style>
<ContentHeader>
</ContentHeader>
<Card>
    <Body>
        <table>
            <tr>
                <td></td>
                <td>
                    <label>Başlangıç Tarihi:</label>
                    <DxDateEdit CssClass="DateTime" @bind-Date="@startDate"></DxDateEdit>
                </td>
                <td>
                    <label>Bitiş Tarihi:</label>
                    <DxDateEdit CssClass="DateTime" @bind-Date="@endDate"></DxDateEdit>
                </td>
                <td>
                    <label></label>
                    <Button Size="ButtonSize.Medium" OnClick="@OnDateButtonClicked">Filtrele</Button>
                </td>
                <td>
                </td>
            </tr>
        </table>

    </Body>

</Card>
<ContentMain>
    <Card>
        <Title><CardTitle><strong>Makina Analizi > Genel</strong></CardTitle></Title>
        <Body>
            <DxChart Data="@data" LabelOverlap="ChartLabelOverlap.Hide">
                <DxChartTitle Text="Plansız Duruş Oran Grafiği">
                </DxChartTitle>
                <DxChartValueAxis>
                    <DxChartAxisTitle Text="Plansız Duruş Oranı" />
                </DxChartValueAxis>
                <DxChartValueAxis Name="Makina Kodu">
                </DxChartValueAxis>
                <DxChartBarSeries Color="System.Drawing.Color.DarkRed"
                                  ArgumentField="@((StationGeneralAnalysis i) => i.Code)"
                                  ValueField="@((StationGeneralAnalysis i) => i.UnplannedPercentage)"
                                  Name="Plansız Duruş Oranı">
                    <DxChartSeriesLabel Format="ChartElementFormat.Percent()" Visible="true" BackgroundColor="System.Drawing.Color.DarkSlateGray" />
                </DxChartBarSeries>
                <DxChartLegend Orientation="Orientation.Horizontal"
                               HorizontalAlignment="HorizontalAlignment.Right"
                               Position="RelativePosition.Outside" />
            </DxChart>

        </Body>
    </Card>
    <Card>
        <Body>
            <DxGrid Data="@data"
                    CssClass="GridZebra"
                    ShowGroupPanel="true"
                    ShowFilterRow="true">
                <Columns>
                    <DxGridCommandColumn Width="120px" />
                    <DxGridDataColumn FieldName="Code"
                                      Caption="Makina Kodu"
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1" />
                    <DxGridDataColumn FieldName="TheoreticalTime"
                                      Caption="Teorik Süre"
                                      Width="120px"
                                      SortOrder="GridColumnSortOrder.Ascending"
                                      SortIndex="0"
                                      DisplayFormat="######" />
                    <DxGridDataColumn FieldName="AvailableTime"
                                      Caption="Kullanılabilir Zaman"
                                      Width="120px"
                                      SortOrder="GridColumnSortOrder.Ascending"
                                      SortIndex="0"
                                      DisplayFormat="######" />
                    <DxGridDataColumn FieldName="StationOnTime"
                                      Caption="Makina Açık Kalma Süresi"
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1"
                                      DisplayFormat="######" />
                    <DxGridDataColumn FieldName="StationProductionTime"
                                      Caption="Üretim Süresi"
                                      Width="120px"
                                      SortOrder="GridColumnSortOrder.Ascending"
                                      SortIndex="0"
                                      DisplayFormat="######" />
                    <DxGridDataColumn FieldName="StationHaltTime"
                                      Caption="Duruş Süresi"
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1"
                                      DisplayFormat="######" />
                    <DxGridDataColumn FieldName="UnplannedHaltTime"
                                      Caption="Plansız Duruş Süresi"
                                      Width="120px"
                                      SortOrder="GridColumnSortOrder.Ascending"
                                      SortIndex="0"
                                      DisplayFormat="######" />
                    <DxGridDataColumn FieldName="PlannedHaltTime"
                                      Caption="Planlı Duruş Süresi"
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1"
                                      DisplayFormat="######" />

                    <DxGridDataColumn FieldName="UnplannedPercentage"
                                      Caption="Plansız Duruş "
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1"
                                      DisplayFormat="@NumericMask.PercentageMultipliedBy100">
                        @* <CellDisplayTemplate>
                        @{
                        StationGeneralAnalysis obj = context as StationGeneralAnalysis;
                        <div class="@(obj.UnplannedPercentage >= Convert.ToDouble(0.90) ? "bg-success" : "bg-danger")" >
                        </div>
                        }
                        </CellDisplayTemplate>*@
                    </DxGridDataColumn>
                    <DxGridDataColumn FieldName="StationID"
                                      Caption="Duruş Kodları Analizi"
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1">
                        <CellDisplayTemplate>
                            <Button Size="ButtonSize.Small" OnClick="@(() => OnDetailButtonClicked((int)context.Value,startDate,endDate))">Detay</Button>
                        </CellDisplayTemplate>
                    </DxGridDataColumn>
                    <DxGridDataColumn FieldName="StationID"
                                      Caption="Stok Kodları Analizi"
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1">
                        <CellDisplayTemplate>
                            <Button Size="ButtonSize.Small" OnClick="@(() => OnDetailButtonClicked((int)context.Value,startDate,endDate))">Detay</Button>
                        </CellDisplayTemplate>
                    </DxGridDataColumn>
                    <DxGridDataColumn FieldName="StationID"
                                      Caption="Personel Analizi"
                                      SortOrder="GridColumnSortOrder.Descending"
                                      SortIndex="1">
                        <CellDisplayTemplate>
                            <Button Size="ButtonSize.Small" OnClick="@(() => OnDetailButtonClicked((int)context.Value,startDate,endDate))">Detay</Button>
                        </CellDisplayTemplate>
                    </DxGridDataColumn>
                </Columns>
            </DxGrid>
        </Body>
    </Card>
</ContentMain>

@code {
    List<StationGeneralAnalysis> data = new List<StationGeneralAnalysis>();
    DateTime startDate = DateTime.Today.AddDays(-60);
    DateTime endDate = DateTime.Today;
    DateTime date1 = DateTime.Today.AddDays(-60);
    DateTime date2 = DateTime.Today;

    protected override void OnInitialized()
    {
        data = IstasyonService.GetStationGeneralAnalyies(date1, date2);
    }

    void OnDateButtonClicked()
    {
        data = IstasyonService.GetStationGeneralAnalyies(startDate, endDate);
        StateHasChanged();
    }
    async void OnDetailButtonClicked(int stationId, DateTime startDate, DateTime endDate)
    {
       
        //endDate = new DateTime(2022, 08, 22);
        NavigationManager.NavigateTo("/machine-analysis-detail/" + stationId + "/" + startDate.ToString("yyyy,MM,dd") + "/" + endDate.ToString("yyyy,MM,dd"));
        //NavigationManager.NavigateTo("/machine-analysis-detail");
    }

}
