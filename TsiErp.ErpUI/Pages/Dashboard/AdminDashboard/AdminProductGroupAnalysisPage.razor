@page "/productgroup-analysis"
@layout MainLayout

@inject IAdminDashboardAppService AdminDashboardAppService
@inject IProductionTrackingsAppService ProductionTrackingsAppService
@inject IGetSQLDateAppService GetSQLDateAppService
@inject NavigationManager NavigationManager
@inject IStringLocalizer<DashboardsResource> L


<SfCard class="TSIListPageTitleCard">
    <CardContent>
        <TsiBreadCrumb PreviousMenus="@L["UIAdminProductGroupPreviousMenu"]" CurrentMenu="@L["UIAdminProductGroupCurrentMenu"]" />
    </CardContent>
    <CardFooter>
    </CardFooter>
</SfCard>
<br />
<SfCard class="FilterCard">
    <CardContent>
        <table width="1000px">
            <tr>
                <td width="200px">
                    <br />
                       <SfCheckBox @bind-Checked="isGridChecked" @onchange="OnCheckedChanged" CssClass="e-customcheck"></SfCheckBox>
                    <label class=FilterLabelTitle><strong>@L["HideDetailTableLabel"]</strong></label>
                </td>
                <td width="200px">
                    <br />
                     <SfCheckBox @bind-Checked="isLabelsChecked" @onchange="OnChangeLabelCheck" CssClass="e-customcheck"></SfCheckBox>
                    <label class=FilterLabelTitle><strong>@L["ShowLabelsLabel"]</strong></label>
                </td>
                <td width="200px">
                    <label class="FilterLabelTitle"><strong>@L["TimePeriodLabel"]</strong></label>
                    <SfComboBox TValue="int?" TItem="ComboboxTimePeriods" @bind-Index="@selectedTimeIndex" PopupHeight="230px" Placeholder="Yıllık" DataSource="@timeperiods">
                        <ComboBoxFieldSettings Text="TimeText" Value="TimeID"></ComboBoxFieldSettings>
                    </SfComboBox>
                </td>
                <td width="200px">
                   @*  <label class="FilterLabelTitle"><strong>@L["ProductGroupListLabel"]</strong></label>
                    <SfComboBox TValue="int?" TItem="string" @bind-Index="@selectedProductIndex" PopupHeight="230px" Placeholder="ROT BAŞI" DataSource="@ProductGrpNameList">
                        <ComboBoxEvents TItem="AdminProductGroupAnalysisGrid" TValue="int?" ValueChange="onChange"></ComboBoxEvents>
                        <ComboBoxFieldSettings Text="ProductGroupName" Value="ProductGroupID"></ComboBoxFieldSettings>
                    </SfComboBox> *@
                </td>
                <td width="100px">
                    <br />
                    <SfButton IsPrimary="true" CssClass="e-btn e-secondary" style="background-color:#AD0000;text-shadow: 6px 3px 4px black; font-size:18px; font-weight:bold" OnClick="@OnDateButtonClicked">@L["FilterButton"]</SfButton>

                    <SfSpinner @bind-Visible="VisibleSpinner">
                    </SfSpinner>

                </td>
                <td width="100px">
                    <br />
                    <SfButton IsPrimary="true" CssClass="e-btn e-secondary" style="background-color:#AD0000;text-shadow: 6px 3px 4px black; font-size:18px; font-weight:bold" OnClick="@OnCompareButtonClicked">@L["CompareButton"]</SfButton>
                </td>
            </tr>
        </table>
    </CardContent>
    <CardFooter>
    </CardFooter>
</SfCard>
<br />
<SfCard class="Cards" style="text-align:center">
    <CardContent>
        <SfChart @ref="ChartInstance" Theme="Theme.Bootstrap5" Title="Ürün Grubu Hurda Grafiği">
            <ChartTitleStyle Size="22px" Color="black" FontWeight="bold"></ChartTitleStyle>
            <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category" LabelIntersectAction="LabelIntersectAction.Rotate45">
                <ChartAxisLabelStyle Size="18px" Color="black" FontWeight="bold" />
            </ChartPrimaryXAxis>
            <ChartPrimaryYAxis Minimum="0" LabelFormat="p2">
                <ChartAxisLabelStyle Size="18px" Color="black" FontWeight="bold" />
            </ChartPrimaryYAxis>
            <ChartTooltipSettings Enable="true">
                <Template>
                    @{
                        var data = context as ChartTooltipInfo;


                        decimal comparisonQUA = ProductGroupList.Where(t => t.SCRAPPERCENT == (decimal)data.Y).Select(t => t.DIFFSCRAPPERCENT).FirstOrDefault();



                        string valueColorQUA = comparisonQUA < 0 ? "#BF0000" : "#068800";

                        string comparisonQUAstr = comparisonQUA.ToString("p2");

                        <div>
                            <table class="TSIChartTooltip">
                                <tr><th style="font-size:16px !important;" colspan="2">@L["ChartTooltipChangeTitle"]</th></tr>
                                <tr><td>@L["ChartTooltipQuality"]</td><td style="color: @valueColorQUA">@comparisonQUAstr</td></tr>
                            </table>
                        </div>

                    }
                </Template>
            </ChartTooltipSettings>
            <ChartSeriesCollection>
                <ChartSeries DataSource="@ProductGroupList" Name="Hurda Oranı" XName="MONTH" YName="SCRAPPERCENT" Width="3" Fill="darkred" Type="Syncfusion.Blazor.Charts.ChartSeriesType.Line">
                    <ChartMarker Visible="true" Width="7" Height="7" IsFilled="true" Shape="ChartShape.Circle">
                        <ChartDataLabel Visible="@dataLabels">
                            <ChartDataLabelFont FontWeight="bold" Size="14px" Color="darkred"></ChartDataLabelFont>
                        </ChartDataLabel>
                    </ChartMarker>
                    <ChartTrendlines>
                        <ChartTrendline EnableTooltip=false Type="TrendlineTypes.Linear" Width="3" Name="Trend" Fill="#3345A7">
                            <ChartTrendlineMarker Visible="true" Width="7" Height="7" IsFilled="true" Shape="ChartShape.Diamond">
                            </ChartTrendlineMarker>
                        </ChartTrendline>
                    </ChartTrendlines>
                </ChartSeries>
            </ChartSeriesCollection>
        </SfChart>

    </CardContent>
    <CardFooter>
        @{
            string chartAverageValue = string.Empty;

            if (ProductGroupList.Count > 0)
            {
                chartAverageValue = ProductGroupList.Average(t => t.SCRAPPERCENT).ToString("p2");
            }

        }
        <center><label class="TSIListPageTitleCardLabel" style="font-size:25px"><span style="color :#AC0000">@chartAverageLabel </span>&nbsp;@chartAverageValue</label></center>
    </CardFooter>
</SfCard>